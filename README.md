# ブログアプリ - SpringBoot4 + JPA 版

## 概要

[ブログアプリ - SpringBoot4 版](https://github.com/shibamirai/katachi-blog-spring4) と同じものを、MyBatis の代わりに JPA を使って実装したものです。

ブログアプリ - SpringBoot4 版 の機能に加え、以下のことを行っています。

- JPA の利用
- N+1 問題対応（Open Session in View を使用せず、必要なところで Join Fetch を行う）
- JPA Specification による動的な検索条件の実装
- ページネーション（Specification と同時に利用する場合の問題に対応）
- Spring Security によるメソッド単位での認可（記事を書いた本人だけが編集できるようにするなど）
- HTMX でのフラッシュメッセージの利用

## 動作環境

- Java 25
- Spring Boot 4.0.2
- H2 Database
- Bootstrap 5.3.8
- Popper.js 2.11.7
- HTMX 2.0.8

## 実行方法

1. 本リポジトリを任意のディレクトリにクローンする

    ```cmd
    > git clone https://github.com/shibamirai/katachi-blog-spring4-jpa.git
    ```

1. ブログに投稿した画像の保存先として任意のディレクトリを用意し、そのパスを application.properties の `app.media.directory` に設定する

    [application.properties]
    ```properties
    # 投稿画像保存先ディレクトリ(末尾に'/'を入れる)
    app.media.directory=C:/`任意のディレクトリ`/
    ```

1. クローンしたリポジトリ内のプロジェクトを Eclipse 等の IDE で開き、Spring Boot アプリとして実行する。またはプロジェクトのルートディレクトリでコマンドラインから下記のように maven で実行する。

    ```cmd
    > cd katachi-blog-spring4-jpa/katachi-blog-spring4-jpa
    > ./mvnw spring-boot:run
    ```

1. ブラウザから [http://localhost:8080/](http://localhost:8080/) を開く

## 初期登録ユーザー情報

|ユーザー名|メールアドレス|パスワード|権限|
| -- |-- |-- |-- |
| 管理者1 | contact@miraino-katachi.co.jp | password | 管理者 |
| 管理者2 | t_shiba@miraino-katachi.co.jp | password | 管理者 |
| 一般ユーザー1 | example@miraino-katachi.co.jp | password | 一般ユーザー |

## 要件定義

### 目的

- ウェブ上で様々な記事を発信して多くの人の注目を集めたい

### 必要要件

- 発信した記事は最新のものから時系列で並べて一覧で表示できること
- 記事の一覧から記事を選んでその内容を見ることができること
- 管理者権限を持つものだけが記事を投稿できること
- 記事の投稿者は自分の記事の修正・削除ができること
- 記事には写真を付与できること
- 記事にはその内容に応じてカテゴリーを付与できること
- 同じカテゴリーの記事だけを選択して表示できること
- 同じ投稿者の記事だけを選択して表示できること
- アカウント登録したユーザは各記事にコメントをつけることができること
- 記事につけられたコメントは、その記事とともに閲覧できること
- コメントは、コメントした本人だけが修正・削除できること

### 管理する情報

- アカウント
    - メールアドレス
    - 名前
    - パスワード
    - 権限（一般／管理者）

- カテゴリー
    - 名称

- 記事
    - カテゴリー
    - タイトル
    - 記事内容
    - 画像
    - 投稿者
    - 投稿日時

- コメント
    - 対象の記事
    - コメント内容
    - コメント投稿者
    - コメント日時

### 機能

#### 記事一覧表示機能
- 記事を最新のものから時系列で表示する

#### 記事フィルタリング機能
- カテゴリフィルタリング機能
- 投稿者フィルタリング機能
- 検索機能

#### 記事個別表示機能
- 個別の記事内容および、そこにつけられたコメントをすべて表示する

#### 記事投稿機能
- 新しく記事を投稿する　※管理者権限を持つユーザのみ可能

#### 記事修正機能
- 記事の内容を修正する　※投稿者本人のみ可能

#### 記事削除機能
- 投稿されている記事を削除する　※投稿者本人のみ可能

#### 一般アカウント登録機能
- 管理者権限を持たないアカウントを登録する　※管理者権限は本システム外で付与する

#### ログイン機能
- 登録されているアカウントでログインを行う
- ログインするとコメントが付与できる
- 管理者アカウントでログインすると記事の投稿・修正・削除が行える

#### コメント付与機能
- 記事に対してコメントを付与する　※ログインユーザのみ可能

#### コメント修正機能
- コメントの内容を修正する　※コメントした本人のみ可能

#### コメント削除機能
- コメントを削除する　※コメントした本人のみ可能
